#!/usr/bin/python
import subprocess
import sys
import re
if len(sys.argv) != 2:
  host=input("Ingrese host: ")
else:
  host=str(sys.argv[1])
cmd="dig NS "+host
direcciones=[]
p = subprocess.Popen(cmd,shell=True, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
for line in p.stdout.readlines():
  if line.find("NS") != -1 and line.find("IN") != -1:
    replace=re.sub("\s+"," ",line[:-1])
    tmp=replace.split(" ")
    #print replace
    #print tmp[-1]
    if tmp[-1] != "NS":
      #print tmp[-1]
      direcciones.append(tmp[-1])

#print direcciones
for direccion in direcciones:
  cmd="dig axfr @"+ direccion +" "+host
  print cmd
  text=""
  p = subprocess.Popen(cmd,shell=True, stdout=subprocess.PIPE, stderr=subprocess.STDOUT)
  line=p.stdout.readline()
  bandera=0
  while line != "":
    if line.find("Transfer failed.") != -1:
      #print line
      bandera=1
      break
    elif line.find("couldn't get address")!= -1:
      #print line
      bandera=1
      break
    else:
      bandera=0
      text=text+line
    line=p.stdout.readline()

  if bandera==0:
    print text
    exit()
